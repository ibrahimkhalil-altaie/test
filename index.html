<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة جلولاء | Supabase Integrated</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root {
            --bg: #000; --fg: #fff; --border: #333; --gray: #111; --amber: #FFB300;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg); color: var(--fg); font-family: 'IBM Plex Sans Arabic', sans-serif; overflow-x: hidden; }

        /* الأنيميشن عند تبديل الصفحات */
        .view { display: none; animation: slideIn 0.3s ease-out forwards; padding: 20px; max-width: 600px; margin: 0 auto; }
        .view.active { display: block; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* نمط Vercel للبطاقات */
        .card { background: var(--gray); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 15px; }
        .loading-shimmer { background: linear-gradient(90deg, #111 25%, #222 50%, #111 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; height: 100px; border-radius: 12px; margin-bottom: 15px; }
        @keyframes shimmer { 100% { background-position: -200% 0; } }

        header { padding: 30px 0; border-bottom: 1px solid var(--border); margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .btn-nav { cursor: pointer; padding: 10px 20px; border: 1px solid var(--border); border-radius: 8px; transition: 0.2s; }
        .btn-nav:hover { background: var(--fg); color: var(--bg); }
    </style>
</head>
<body>

    <div id="homeView" class="view active">
        <header>
            <h1>الرئيسية</h1>
            <div class="btn-nav" onclick="showView('lessonsView', fetchLessons)">تحاضيري اليومية <i data-lucide="chevron-left" style="vertical-align: middle;"></i></div>
        </header>
        <div class="card">أهلاً بك يا إبراهيم، يمكنك متابعة تحاضيرك ودرجاتك من هنا.</div>
    </div>

    <div id="lessonsView" class="view">
        <header>
            <div onclick="showView('homeView')" style="cursor:pointer; color: var(--amber)"><i data-lucide="arrow-right"></i> عودة</div>
            <h1>تحاضيري</h1>
        </header>
        
        <div id="lessonsContainer">
            </div>
    </div>

    <script>
        // إعدادات Supabase (ضع روابطك هنا)
        const SUPABASE_URL = 'YOUR_SUPABASE_URL';
        const SUPABASE_KEY = 'YOUR_SUPABASE_ANON_KEY';

        // وظيفة التنقل بين الصفحات
        function showView(viewId, callback = null) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            if (callback) callback();
        }

        // وظيفة جلب البيانات من Supabase
        async function fetchLessons() {
            const container = document.getElementById('lessonsContainer');
            
            // 1. إظهار تأثير التحميل (Shimmer)
            container.innerHTML = `<div class="loading-shimmer"></div><div class="loading-shimmer"></div>`;

            try {
                // طلب البيانات من جدول 'lessons' في Supabase
                const response = await fetch(`${SUPABASE_URL}/rest/v1/lessons?select=*`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const data = await response.json();

                // 2. معالجة البيانات وعرضها
                container.innerHTML = ''; // مسح الـ Loading
                
                if (data.length === 0) {
                    container.innerHTML = '<div style="text-align:center; color:#666;">لا توجد تحاضير لليوم</div>';
                } else {
                    data.forEach(item => {
                        // إخفاء الحقول الفارغة كما طلبت سابقاً
                        if (item.content && item.content.trim() !== "") {
                            container.innerHTML += `
                                <div class="card">
                                    <div style="color: var(--amber); font-weight:700; margin-bottom:10px;">${item.subject_name}</div>
                                    <p style="font-size:15px; line-height:1.6;">${item.content}</p>
                                    <div style="font-size:11px; color:#555; margin-top:10px;">أضيف بواسطة: ${item.teacher_name}</div>
                                </div>
                            `;
                        }
                    });
                }
            } catch (error) {
                container.innerHTML = '<div style="color:red;">حدث خطأ في جلب البيانات</div>';
                console.error(error);
            }
        }

        lucide.createIcons();
    </script>
</body>
</html>
