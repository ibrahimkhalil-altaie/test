<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>تسجيل الدخول</title>
<style>
body { font-family: Arial, sans-serif; direction: rtl; padding: 20px; }
label { display: block; margin-top: 10px; }
input, select, button { margin-top: 5px; padding: 8px; width: 220px; }
button { cursor: pointer; margin-top: 15px; }
</style>
</head>
<body>

<h2>تسجيل الدخول</h2>

<label>الرقم التسلسلي</label>
<input type="number" id="serial" placeholder="مثال: 3">

<label>الصف</label>
<select id="grade">
  <option value="الرابع علمي">الرابع</option>
  <option value="الخامس علمي">الخامس</option>
  <option value="السادس علمي">السادس</option>
</select>

<label>الشعبة</label>
<select id="class">
  <option value="أ">أ</option>
  <option value="ب">ب</option>
  <option value="ج">ج</option>
  <option value="د">د</option>
</select>

<label>كلمة السر</label>
<input type="password" id="password" placeholder="كلمة السر">

<button id="loginBtn">تسجيل الدخول</button>

<script>
document.getElementById('loginBtn').addEventListener('click', async () => {
    const serial = document.getElementById('serial').value;
    const gradeText = document.getElementById('grade').value;
    const classText = document.getElementById('class').value;
    const password = document.getElementById('password').value;

    if(!serial || !password) {
        alert("الرجاء ملء جميع الحقول");
        return;
    }

    // تحويل الصف إلى الرقم
    let gradeNum = "";
    if(gradeText.includes("الرابع")) gradeNum = "4";
    else if(gradeText.includes("الخامس")) gradeNum = "5";
    else if(gradeText.includes("السادس")) gradeNum = "6";

    // تحويل الشعبة إلى الرمز
    let classCode = "";
    switch(classText) {
        case "أ": classCode = "a"; break;
        case "ب": classCode = "b"; break;
        case "ج": classCode = "g"; break;
        case "د": classCode = "d"; break;
    }

    // بناء البريد الإلكتروني
    const email = `${gradeNum}.${classCode}.${serial}@school.user`;

    // إعداد body للطلب
    const body = {
        email: email,
        password: password,
        device_id: "a",
        device_ip: 0,
        ip: 1,
        device_name: "HONOR"
    };

    try {
        const response = await fetch("https://dwqxsvqtkswobotneirp.supabase.co/functions/v1/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
        });

        const data = await response.json();

        // عرض الرد في Dialog جميل
        alert(JSON.stringify(data, null, 2));

    } catch (err) {
        alert("حدث خطأ في الاتصال: " + err);
    }
});
</script>

</body>
</html>
